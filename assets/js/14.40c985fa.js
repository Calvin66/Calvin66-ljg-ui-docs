(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{419:function(s,a,n){"use strict";n.r(a);var e=n(12),t=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"docker-部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-部署"}},[s._v("#")]),s._v(" Docker 部署")]),s._v(" "),a("h2",{attrs:{id:"_1-下载项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-下载项目"}},[s._v("#")]),s._v(" 1. 下载项目")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("git clone https://github.com/galaxy-data-cn/chitu-sdp.git\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_2-启动服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动服务"}},[s._v("#")]),s._v(" 2. 启动服务")]),s._v(" "),a("p",[a("strong",[s._v("2.1 进入项目部署路径下")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd chitu-sdp/docs/deploy/docker\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("2.2 启动")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker-compose -f docker-compose.yml up  -d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("2.3 查看服务状态")])]),s._v(" "),a("p",[a("img",{attrs:{src:"/docs//docker/docker1.png",alt:"输入图片说明"}})]),s._v(" "),a("p",[a("strong",[s._v("2.4 查看后端服务日志")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker exec -it sdp-backend bash\ntail -f /app/logs/chitu-provider-1.0.0-SNAPSHOT-12222-start.out \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"_3-登录平台"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-登录平台"}},[s._v("#")]),s._v(" 3. 登录平台")]),s._v(" "),a("p",[s._v("http://宿主机地址:38081/")]),s._v(" "),a("p",[a("img",{attrs:{src:"/docs/docker/docker2.png",alt:"输入图片说明"}})]),s._v(" "),a("p",[s._v("Tips：如需体验提交任务，需要提前准备好 Hadoop 并参考附录 4.3 进行配置。")]),s._v(" "),a("h2",{attrs:{id:"_4-附录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-附录"}},[s._v("#")]),s._v(" 4. 附录")]),s._v(" "),a("h3",{attrs:{id:"_4-1-安装-docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-安装-docker"}},[s._v("#")]),s._v(" 4.1 安装 docker")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("sudo yum remove docker \\\n                  docker-client \\\n                  docker-client-latest \\\n                  docker-common \\\n                  docker-latest \\\n                  docker-latest-logrotate \\\n                  docker-logrotate \\\n                  docker-selinux \\\n                  docker-engine-selinux \\\n                  docker-engine\nsudo yum install -y yum-utils device-mapper-persistent-data lvm2\nsudo yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo \nsudo yum makecache fast\nsudo yum install docker-ce docker-ce-cli containerd.io\nsudo systemctl start docker\ndocker version\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"_4-2-安装-docker-compose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-安装-docker-compose"}},[s._v("#")]),s._v(" 4.2 安装 docker-compose")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("wget https://github.com/docker/compose/releases/download/v2.12.2/docker-compose-linux-x86_64 -O /usr/bin/docker-compose\nsudo chmod +x /usr/bin/docker-compose\ndocker-compose --version\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_4-3-配置-hadoop-环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-配置-hadoop-环境"}},[s._v("#")]),s._v(" 4.3 配置 hadoop 环境")]),s._v(" "),a("p",[a("strong",[s._v("安装 hadoop 集群")])]),s._v(" "),a("p",[s._v("步骤省略...")]),s._v(" "),a("p",[a("strong",[s._v("下载 flink 安装包")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("wget https://archive.apache.org/dist/flink/flink-1.14.3/flink-1.14.3-bin-scala_2.11.tgz\nwget https://archive.apache.org/dist/flink/flink-1.15.2/flink-1.15.2-bin-scala_2.12.tgz \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("配置 hadoop 环境 Dockerfile")])]),s._v(" "),a("p",[s._v("vi Dockerfile")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("FROM registry.cn-hangzhou.aliyuncs.com/sutao_aliyun/chitu-sdp-backend:1.0\nRUN mkdir -p /opt/apache\nADD flink-1.14.3-bin-scala_2.11.tgz /opt/apache/\nADD flink-1.15.2-bin-scala_2.12.tgz /opt/apache/\n# 这个 hadoop 根据自己的环境进行替换\nADD hadoop-3.1.4.tar.gz /opt/apache/\nRUN ln -s /opt/apache/hadoop-3.1.4 /opt/apache/hadoop\nENV HADOOP_HOME=/opt/apache/hadoop\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("p",[a("strong",[s._v("构建镜像")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker build -t registry.cn-hangzhou.aliyuncs.com/sutao_aliyun/chitu-sdp-backend:1.0 . --no-cache\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("创建 hdfs 目录，上传 flink 核心基础 jar包")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("hdfs dfs -mkdir -p /sdp/savepoints\nhdfs dfs -mkdir -p /sdp/ck\nhdfs dfs -mkdir -p /sdp/plugins\nhdfs dfs -mkdir -p /sdp/flink\n\nwget https://github.com/galaxy-data-cn/chitu-sdp/releases/download/v0.1.0/chitu-sdp-flink-sqlclient-1.14-1.0.0-SNAPSHOT.jar\nwget https://github.com/galaxy-data-cn/chitu-sdp/releases/download/v0.1.0/chitu-sdp-flink-sqlclient-1.15-1.0.0-SNAPSHOT.jar\nhdfs dfs -put chitu-sdp-flink-sqlclient-1.14-1.0.0-SNAPSHOT.jar /sdp/plugins\nhdfs dfs -put chitu-sdp-flink-sqlclient-1.15-1.0.0-SNAPSHOT.jar /sdp/plugins\n\ntar -zxvf flink-1.14.3-bin-scala_2.11.tgz\ntar -zxvf flink-1.15.2-bin-scala_2.12.tgz \nhdfs dfs -put flink-1.14.3 /sdp/flink\nhdfs dfs -put flink-1.15.2 /sdp/flink\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[a("strong",[s._v("修改 docker-compose.yml")])]),s._v(" "),a("p",[s._v("修改 extra_hosts 配置，改成自己的 hadoop 集群主机名 ip 映射")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('version: \'4\'\nservices:\n  sdp_front:\n    image: registry.cn-hangzhou.aliyuncs.com/sutao_aliyun/chitu-sdp-front:1.0\n    container_name: sdp-front\n    restart: always\n    ports:\n      - 38081:80\n    depends_on: \n      - sdp_backend\n  sdp_backend:\n    image: registry.cn-hangzhou.aliyuncs.com/sutao_aliyun/chitu-sdp-backend:1.0\n    container_name: sdp-backend\n    restart: always\n    depends_on: \n      - sdp_submit114\n      - sdp_submit115\n      - nacos\n      - redis\n      - mysql\n    extra_hosts:\n      - "hadoop01:172.16.81.161"\n      - "hadoop02:172.16.81.162"\n      - "hadoop03:172.16.81.163"\n    expose:\n      - 12222\n    command: /bin/sh -c "/app/sh/bigdata-services start chitu-provider-1.0.0-SNAPSHOT 12222"\n  sdp_submit114:\n    image: registry.cn-hangzhou.aliyuncs.com/sutao_aliyun/chitu-sdp-backend:1.0\n    container_name: sdp-submit114\n    restart: always\n    expose:\n      - 12282\n    extra_hosts:\n      - "hadoop01:172.16.81.161"\n      - "hadoop02:172.16.81.162"\n      - "hadoop03:172.16.81.163"\n    command: /bin/sh -c "sh /app/sh/bigdata-services start chitu-flink-submit-114-1.0.0-SNAPSHOT 12282"\n  sdp_submit115:\n    image: registry.cn-hangzhou.aliyuncs.com/sutao_aliyun/chitu-sdp-backend:1.0\n    container_name: sdp-submit115\n    restart: always\n    expose:\n      - 12283\n    extra_hosts:\n      - "hadoop01:172.16.81.161"\n      - "hadoop02:172.16.81.162"\n      - "hadoop03:172.16.81.163"\n    command: /bin/sh -c "sh /app/sh/bigdata-services start chitu-flink-submit-115-1.0.0-SNAPSHOT 12283"\n  nacos:\n    image: nacos/nacos-server:1.1.4\n    container_name: nacos-standalone\n    environment:\n      - PREFER_HOST_MODE=hostname\n      - MODE=standalone\n    ports:\n      - "8848:8848"\n      - "9848:9848"\n  prometheus:\n    container_name: prometheus\n    image: prom/prometheus:latest\n    volumes:\n      - ./prometheus/prometheus-standalone.yaml:/etc/prometheus/prometheus.yml\n    ports:\n      - "29090:9090"\n    depends_on:\n      - nacos\n    restart: on-failure\n  grafana:\n    container_name: grafana\n    image: grafana/grafana:latest\n    ports:\n      - 30003:3000\n    restart: on-failure\n  pushgateway:\n    image: prom/pushgateway\n    container_name: pushgateway\n    user: root\n    restart: always\n    ports:\n      - "9091:9091"\n  redis:\n    restart: always\n    image: redis\n    container_name: chitu-redis\n    ports:\n      - 6379:6379\n    command: redis-server\n  mysql:\n    container_name: chitu-mysql\n    environment:\n            MYSQL_ROOT_PASSWORD: "123456"\n            MYSQL_USER: \'chitu\'\n            MYSQL_PASS: \'123456\'\n    image: mysql:5.7.28\n    restart: always\n    volumes:\n         - "./init:/docker-entrypoint-initdb.d/"\n    ports:\n         - "3306:3306"\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br")])]),a("p",[a("strong",[s._v("重启服务")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("docker-compose -f docker-compose.yml down\ndocker-compose -f docker-compose.yml up  -d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);